<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTEVE 2.0 - RANGO TOTAL</title>
    <style>
        :root { --p: #f39c12; --bg: #0f0f0f; --card: #1a1a1a; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--p); }
        h3 { color: var(--p); margin: 0 0 10px 0; font-size: 1.1em; text-transform: uppercase; }
        label { display: block; font-size: 0.8em; color: #888; margin-top: 10px; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--p); border: none; color: #000; font-weight: bold; border-radius: 8px; margin-top: 15px; cursor: pointer; }
        .res-box { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; font-size: 0.9em; }
        .val { color: #2ecc71; font-weight: bold; }
        .seccion-titulo { color: #f39c12; font-weight: bold; margin-top: 15px; border-bottom: 1px solid #444; display: block; font-size: 0.9em; text-align: center; background: #222; padding: 5px; }
        .preview { width: 100%; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid var(--p); }
    </style>
</head>
<body>

<div class="card">
    <h3>üì∏ AUDITOR√çA C√ÅMARA IA</h3>
    <button style="background:#3498db; color:white;" onclick="document.getElementById('file-input').click()">üì∏ CAPTURAR IMAGEN CUADRO</button>
    <input type="file" id="file-input" accept="image/*" capture="environment" style="display:none" onchange="previewImage(event)">
    <img id="img-preview" class="preview">
</div>

<div class="card">
    <h3>üèóÔ∏è DATOS DE INGENIER√çA</h3>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>N¬∫ Placas</label><input type="number" id="nP" value="10"></div>
        <div style="flex:1;"><label>W Placa</label><input type="number" id="wP" value="500"></div>
    </div>
    <label>Inversor (kW)</label><input type="number" id="pI" value="5">
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Mts AC (Tubo)</label><input type="number" id="mAC" value="10"></div>
        <div style="flex:1;"><label>Mts DC (Canal)</label><input type="number" id="mDC" value="15"></div>
    </div>
    <label>üé§ OBSERVACIONES (VOZ/TEXTO)</label>
    <textarea id="obs" rows="2" placeholder="Dicta aqu√≠..."></textarea>
    <button style="background:#e74c3c; color:white; padding:10px;" onclick="dictar()">üé§ ACTIVAR MICRO</button>
</div>

<button onclick="calcular()">GENERAR PEDIDO T√âCNICO</button>
<div id="resultado"></div>
<button id="wa-btn" style="display:none; background:#25d366; color:white; width:100%; padding:15px; border-radius:8px; border:none; font-weight:bold;" onclick="enviar()">üì§ ENVIAR WHATSAPP</button>

<script>
    function previewImage(event) {
        const output = document.getElementById('img-preview');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.style.display = 'block';
    }

    function dictar() {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.lang = 'es-ES'; rec.start();
        rec.onresult = (e) => { document.getElementById('obs').value += e.results[0][0].transcript + " "; };
    }

    function calcular() {
        const pI = parseFloat(document.getElementById('pI').value);
        const nP = parseInt(document.getElementById('nP').value);
        const wP = parseInt(document.getElementById('wP').value);
        const mAC = parseFloat(document.getElementById('mAC').value);
        const mDC = parseFloat(document.getElementById('mDC').value);

        const kwp = (nP * wP) / 1000;
        const perfil = Math.ceil((nP / 2) * 2.35);
        const escuadras = (Math.ceil(((1.13 * nP) + 0.30) / 1.3) + 1) * 2;
        const grapas = Math.ceil((mAC + mDC) / 1.5);

        // L√ìGICA DE AMPERAJE REAL (Trif√°sica vs Monof√°sica)
        let amp = (pI <= 6) ? (pI * 1000 / 230) : (pI * 1000 / (1.732 * 400));
        let factor = amp * 1.25;
        
        let mag, dif;
        if (factor <= 25) { mag = "25A"; dif = "40A Clase A"; }
        else if (factor <= 40) { mag = "40A"; dif = "40A Clase A"; }
        else if (factor <= 63) { mag = "63A"; dif = "63A Clase A"; }
        else if (factor <= 100) { mag = "100A"; dif = "100A Clase A"; }
        else if (factor <= 160) { mag = "160A (MCCB)"; dif = "Toroidal + Rel√©"; }
        else if (factor <= 250) { mag = "250A (MCCB)"; dif = "Toroidal + Rel√©"; }
        else { mag = "400A (MCCB)"; dif = "Toroidal + Rel√©"; }

        let polos = (pI <= 6) ? "2P" : "4P";

        document.getElementById('resultado').innerHTML = `
            <div class="card">
                <span class="seccion-titulo">‚ö° ALTERNATING (AC)</span>
                <div class="res-box"><span>Magneto / Dif:</span><span class="val">${polos} ${mag} / ${dif}</span></div>
                <div class="res-box"><span>Tubo AC:</span><span class="val">${mAC} m</span></div>
                
                <span class="seccion-titulo">‚òÄÔ∏è CONTINUOUS (DC)</span>
                <div class="res-box"><span>Potencia Campo:</span><span class="val">${kwp} kWp (${pI}kW Inv)</span></div>
                <div class="res-box"><span>Metros Perfil:</span><span class="val">${perfil} m</span></div>
                <div class="res-box"><span>Grapas (1.5m):</span><span class="val">${grapas} uds</span></div>

                <span class="seccion-titulo">üî© TERMINALS / MATERIALS</span>
                <div class="res-box"><span>Escuadras L:</span><span class="val">${escuadras} uds</span></div>
                <div class="res-box"><span>Tornillo/Taco/Arand:</span><span class="val">${escuadras*2} uds</span></div>

                <span class="seccion-titulo">üõ°Ô∏è GROUND</span>
                <div class="res-box"><span>Tierra General:</span><span class="val">OK (Cuadro y Estructura)</span></div>
            </div>`;
        
        document.getElementById('wa-btn').style.display = 'block';
    }
</script>
</body>
</html>
