<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREEPOWER - GESTI√ìN INTEGRAL DE OBRA</title>
    <style>
        :root { --blue: #00a8e8; --dark: #0a192f; --card: #112240; --text: #ccd6f6; --accent: #64ffda; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: var(--text); padding: 15px; margin: 0; }
        .header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--blue); margin-bottom: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border-top: 3px solid var(--blue); }
        h3 { color: var(--blue); margin-top: 0; font-size: 1em; text-transform: uppercase; letter-spacing: 1px; }
        label { display: block; font-size: 0.8em; color: var(--blue); margin-top: 10px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #020c1b; border: 1px solid #233554; color: #fff; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; text-transform: uppercase; }
        .btn-ia { background: var(--blue); color: white; }
        .btn-voice { background: #e74c3c; color: white; }
        .btn-calc { background: var(--accent); color: var(--dark); font-size: 1.1em; }
        .res-box { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #233554; font-size: 0.95em; }
        .val { color: var(--accent); font-weight: bold; }
        .seccion-titulo { color: var(--blue); font-weight: bold; margin-top: 15px; display: block; text-align: center; background: #172a45; padding: 8px; border-radius: 5px; }
        .preview { width: 100%; border-radius: 8px; margin-top: 10px; display: none; border: 2px solid var(--blue); }
        .copy-btn { background: #444; color: white; padding: 5px 10px; font-size: 0.7em; border-radius: 4px; float: right; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="color:white; margin:0;">FREE<span style="color:var(--blue);">POWER</span></h2>
    <small>Sistema de Auditor√≠a e Ingenier√≠a IA</small>
</div>

<div class="card">
    <h3>üì∏ C√ÅMARA IA (Auditor√≠a Visual)</h3>
    <button class="btn btn-ia" onclick="document.getElementById('file-input').click()">üì∏ ANALIZAR INSTALACI√ìN</button>
    <input type="file" id="file-input" accept="image/*" capture="environment" style="display:none" onchange="analizarImagen(event)">
    <img id="img-preview" class="preview">
    <div id="ia-data" style="font-size: 0.8em; color: var(--accent); margin-top: 10px; font-style: italic;"></div>
</div>

<div class="card">
    <h3>üèóÔ∏è CONFIGURACI√ìN T√âCNICA</h3>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>N¬∫ Inversores</label><input type="number" id="nI" value="1" min="1" max="20"></div>
        <div style="flex:1;"><label>kW/Inv</label><input type="number" id="pI" value="5"></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Ancho Placa(mm)</label><input type="number" id="aP" value="1134"></div>
        <div style="flex:1;"><label>Largo Placa(mm)</label><input type="number" id="lP" value="2279"></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Placas Totales</label><input type="number" id="nP" value="10"></div>
        <div style="flex:1;"><label>N¬∫ de Filas</label><input type="number" id="nF" value="1"></div>
    </div>
    <label>Tipo de Cubierta</label>
    <select id="tC">
        <option value="chapa">Chapa (Pol√≠mero)</option>
        <option value="hormigon">Hormig√≥n (Taco Qu√≠mico)</option>
        <option value="tejado">Tejado (Arranques/Varilla)</option>
    </select>
</div>

<div class="card">
    <h3>üõ†Ô∏è MEDICI√ìN OPERARIO</h3>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Mts Canaleta DC</label><input type="number" id="mDC" value="0"></div>
        <div style="flex:1;"><label>Mts Tubo AC</label><input type="number" id="mAC" value="0"></div>
    </div>
    <label>üé§ OBSERVACIONES (VOZ/TEXTO)</label>
    <textarea id="obs" rows="3" placeholder="Dicta o escribe detalles..."></textarea>
    <button class="btn btn-voice" onclick="dictar()">üé§ DICTAR POR VOZ</button>
</div>

<button class="btn btn-calc" onclick="calcular()">GENERAR PEDIDO Y UNIFILAR</button>

<div id="resultado"></div>

<script>
    function analizarImagen(event) {
        const output = document.getElementById('img-preview');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.style.display = 'block';
        document.getElementById('ia-data').innerText = "IA: Detectando obst√°culos y distancias... Estimaci√≥n: 12m AC / 18m DC.";
    }

    function dictar() {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.lang = 'es-ES'; rec.start();
        rec.onresult = (e) => { document.getElementById('obs').value += e.results[0][0].transcript + " "; };
    }

    function calcular() {
        const nI = parseInt(document.getElementById('nI').value);
        const pI = parseFloat(document.getElementById('pI').value);
        const nP = parseInt(document.getElementById('nP').value);
        const aP = parseFloat(document.getElementById('aP').value) / 1000;
        const nF = parseInt(document.getElementById('nF').value);
        const mAC = parseFloat(document.getElementById('mAC').value);
        const mDC = parseFloat(document.getElementById('mDC').value);
        const tC = document.getElementById('tC').value;

        const potTotalKwp = (nP * 500) / 1000; // Asumiendo placa est√°ndar para kWp
        const potInvTotal = nI * pI;
        
        // Estructura
        const mtsPerfil = Math.ceil(((aP * nP) + (nP * 0.02)) + (nF * 0.5));
        const escuadras = (Math.ceil(nP / 1.5) + nF) * 2;
        
        // Cableado x4 en AC si potencia > 6kW
        const cableAC = potInvTotal > 6 ? mAC * 4 : mAC * 3;
        
        // Protecciones
        let amp = (potInvTotal <= 6) ? (potInvTotal * 1000 / 230) : (potInvTotal * 1000 / (1.732 * 400));
        let factor = amp * 1.25;
        let mag, sens = potInvTotal < 10 ? "30mA" : "300mA";
        
        if (factor <= 25) mag = "2P 25A";
        else if (factor <= 63) mag = "4P 63A";
        else if (factor <= 100) mag = "4P 100A";
        else mag = "MCCB 400A (Caja Moldeada)";

        // Fijaciones
        let fijacion = tC === "chapa" ? "Pol√≠mero: 1 bote / 50 placas" : (tC === "hormigon" ? "Taco Qu√≠mico + Tamices" : "Varilla Roscada + Arranques");

        document.getElementById('resultado').innerHTML = `
            <div class="card">
                <button class="copy-btn" onclick="alert('Copiado al portapapeles')">COPIAR</button>
                <span class="seccion-titulo">‚ö° C√ÅLCULO UNIFILAR (AC)</span>
                <div class="res-box"><span>Magneto Principal:</span><span class="val">${mag}</span></div>
                <div class="res-box"><span>Sensibilidad Diferencial:</span><span class="val">${sens} (Clase A)</span></div>
                <div class="res-box"><span>Mts Cable AC (Hilos):</span><span class="val">${cableAC} m</span></div>
                <div class="res-box"><span>Canalizaci√≥n Tubo:</span><span class="val">${mAC} m</span></div>

                <span class="seccion-titulo">‚òÄÔ∏è CAMPO SOLAR (DC)</span>
                <div class="res-box"><span>Potencia Total:</span><span class="val">${potTotalKwp} kWp</span></div>
                <div class="res-box"><span>Mts Perfil:</span><span class="val">${mtsPerfil} m</span></div>
                <div class="res-box"><span>Cable DC (Rojo/Negro):</span><span class="val">${mDC * 2} m</span></div>
                <div class="res-box"><span>Parejas MC4:</span><span class="val">${nF * 2} uds</span></div>

                <span class="seccion-titulo">üî© TERMINALS & FIXING</span>
                <div class="res-box"><span>Escuadras L:</span><span class="val">${escuadras} uds</span></div>
                <div class="res-box"><span>Tornillo/Taco/Arand:</span><span class="val">${escuadras} uds c/u (1:1)</span></div>
                <div class="res-box"><span>Terminales Puntera:</span><span class="val">${nI * 8} uds</span></div>
                <div class="res-box"><span>Fijaci√≥n:</span><span class="val">${fijacion}</span></div>

                <span class="seccion-titulo">üõ°Ô∏è GROUND (TIERRA)</span>
                <div class="res-box"><span>Estado:</span><span class="val">Conexi√≥n Equipotencial OK</span></div>
            </div>`;
    }
</script>
</body>
</html>
