<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTEVE 2.0 - IA + VOZ</title>
    <style>
        :root { --p: #f39c12; --bg: #0f0f0f; --card: #1a1a1a; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .header { text-align: center; padding: 10px; border-bottom: 2px solid var(--p); margin-bottom: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--p); }
        h3 { color: var(--p); margin: 0 0 10px 0; font-size: 1.1em; text-transform: uppercase; }
        label { display: block; font-size: 0.8em; color: #888; margin-top: 10px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--p); border: none; color: #000; font-weight: bold; border-radius: 8px; margin-top: 15px; cursor: pointer; font-size: 1.1em; }
        .res-box { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #2a2a2a; font-size: 0.9em; }
        .val { color: #2ecc71; font-weight: bold; }
        #camera-btn { background: #3498db; color: #fff; margin-bottom: 10px; }
        #mic-btn { background: #e74c3c; color: #fff; margin-top: 5px; padding: 10px; font-size: 0.9em; }
        #wa-btn { background: #25d366; color: #fff; display:none; }
        .preview { width: 100%; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid var(--p); }
        .seccion-titulo { color: #f39c12; font-weight: bold; margin-top: 15px; border-bottom: 1px solid #444; display: block; font-size: 0.9em; }
    </style>
</head>
<body>
<div class="header"><h1>ESTEVE 2.0 ü§ñüéôÔ∏è</h1></div>

<div class="card">
    <h3>üì∏ An√°lisis de Cuadro</h3>
    <button id="camera-btn" onclick="document.getElementById('file-input').click()">üì∏ TOMAR FOTO</button>
    <input type="file" id="file-input" accept="image/*" capture="environment" style="display:none" onchange="previewImage(event)">
    <img id="img-preview" class="preview">
</div>

<div class="card">
    <h3>üèóÔ∏è Datos y Material</h3>
    <label>Obra</label><input type="text" id="obra" placeholder="Nombre obra">
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Placas</label><input type="number" id="nP" value="10"></div>
        <div style="flex:1;"><label>Tejado</label><select id="tejado"><option value="Bovedilla">Bovedilla</option><option value="Sandwich">Sandwich</option></select></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Mts AC</label><input type="number" id="mAC" value="10"></div>
        <div style="flex:1;"><label>Mts DC</label><input type="number" id="mDC" value="20"></div>
    </div>

    <label>üìù Observaciones (Voz o Escrito)</label>
    <textarea id="obs" rows="3" placeholder="Ej: El cuadro est√° en el garaje..."></textarea>
    <button id="mic-btn" onclick="dictar()">üé§ DICTAR POR VOZ</button>
</div>

<button onclick="calcular()">GENERAR PEDIDO TOTAL</button>
<div id="resultado"></div>
<button id="wa-btn" onclick="enviar()">üì§ ENVIAR ALMAC√âN</button>

<script>
    let msgWA = "";

    function previewImage(event) {
        const output = document.getElementById('img-preview');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.style.display = 'block';
    }

    function dictar() {
        if (!('webkitSpeechRecognition' in window)) {
            alert("Tu navegador no soporta dictado por voz. Prueba con Chrome.");
            return;
        }
        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'es-ES';
        recognition.start();
        document.getElementById('mic-btn').innerText = "üî¥ ESCUCHANDO...";
        recognition.onresult = (event) => {
            document.getElementById('obs').value += event.results[0][0].transcript + " ";
            document.getElementById('mic-btn').innerText = "üé§ DICTAR POR VOZ";
        };
        recognition.onerror = () => { document.getElementById('mic-btn').innerText = "üé§ DICTAR POR VOZ"; };
    }

    function calcular() {
        const obra = document.getElementById('obra').value || "Sin nombre";
        const nP = parseInt(document.getElementById('nP').value);
        const mAC = parseFloat(document.getElementById('mAC').value);
        const mDC = parseFloat(document.getElementById('mDC').value);
        const tejado = document.getElementById('tejado').value;
        const obs = document.getElementById('obs').value;

        const fijaciones = (Math.ceil(((1.13 * nP) + 0.30) / 1.3) + 1) * 2;
        const grapas = Math.ceil((mAC + mDC) / 1.5);

        document.getElementById('resultado').innerHTML = `
            <div class="card" style="border-left-color: #2ecc71">
                <span class="seccion-titulo">üî© MATERIAL CALCULADO</span>
                <div class="res-box"><span>Escuadras:</span><span class="val">${fijaciones} uds</span></div>
                <div class="res-box"><span>Grapas Met. (1.5m):</span><span class="val">${grapas} uds</span></div>
                <div class="res-box"><span>Observaciones:</span><span class="val">${obs ? 'S√ç' : 'NO'}</span></div>
            </div>`;
        
        document.getElementById('wa-btn').style.display = 'block';
        msgWA = `*PEDIDO: ${obra}*%0Aüî© Fijaciones: ${fijaciones}%0AüèóÔ∏è Grapas: ${grapas}%0Aüìù *OBS:* ${obs}`;
    }

    function enviar() { window.open(`https://wa.me/?text=${msgWA}`, '_blank'); }
</script>
</body>
</html>
