<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTEVE 2.0 - Ingenier√≠a</title>
    <style>
        :root { --p: #f39c12; --bg: #0f0f0f; --card: #1a1a1a; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--p); margin-bottom: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        h3 { color: var(--p); margin-top: 0; font-size: 1.1em; border-bottom: 1px solid #333; padding-bottom: 5px; }
        label { display: block; font-size: 0.85em; color: #888; margin-top: 10px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        button { width: 100%; padding: 15px; background: var(--p); border: none; color: #000; font-weight: bold; border-radius: 8px; cursor: pointer; font-size: 1em; margin-top: 10px; }
        .res-box { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #2a2a2a; font-size: 0.95em; }
        .val { color: #2ecc71; font-weight: bold; }
        #wa-btn { background: #25d366; color: #fff; margin-top: 15px; display:none; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0; font-size: 1.4em;">ESTEVE 2.0</h1>
    <span style="font-size: 0.8em; color: #888;">C√°lculo de Materiales Fotovoltaicos</span>
</div>

<div class="card">
    <h3>üèóÔ∏è Datos de Estructura</h3>
    <label>Nombre de la Obra</label>
    <input type="text" id="obra" placeholder="Ej: Caldes Porc">
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>N¬∫ Placas</label><input type="number" id="nP" value="10"></div>
        <div style="flex:1;"><label>Potencia (W)</label><input type="number" id="pP" value="550"></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Ancho Placa (m)</label><input type="number" id="aP" step="0.01" value="1.13"></div>
        <div style="flex:1;"><label>N¬∫ Filas</label><input type="number" id="nF" value="1"></div>
    </div>
</div>

<div class="card">
    <h3>üîå Datos El√©ctricos (Ley de Ohm)</h3>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>Inversores</label><input type="number" id="nI" value="1"></div>
        <div style="flex:1;"><label>Potencia Inv (kW)</label><input type="number" id="pI" value="5"></div>
    </div>
    <div style="display:flex; gap:10px;">
        <div style="flex:1;"><label>M. Continua (DC)</label><input type="number" id="mDC" value="20"></div>
        <div style="flex:1;"><label>M. Alterna (AC)</label><input type="number" id="mAC" value="10"></div>
    </div>
    <label>Tejado</label>
    <select id="tejado">
        <option value="Bovedilla">Viga / Bovedilla (Taco Qu√≠mico)</option>
        <option value="Sandwich">Sandwich / Chapa (Autoroscante)</option>
    </select>
</div>

<div class="card">
    <h3>üéôÔ∏è Observaciones</h3>
    <textarea id="obs" placeholder="Dicta o escribe aqu√≠..."></textarea>
</div>

<button onclick="generar()">CALCULAR MATERIALES</button>

<div id="resultado"></div>
<button id="wa-btn" onclick="enviarWA()">üì§ ENVIAR PEDIDO ALMAC√âN</button>

<script>
    let mensajeWA = "";

    function generar() {
        const obra = document.getElementById('obra').value || "Sin nombre";
        const nP = parseInt(document.getElementById('nP').value);
        const pP = parseInt(document.getElementById('pP').value);
        const aP = parseFloat(document.getElementById('aP').value);
        const nF = parseInt(document.getElementById('nF').value);
        const pI = parseFloat(document.getElementById('pI').value) * parseInt(document.getElementById('nI').value);
        const mAC = parseFloat(document.getElementById('mAC').value);
        const mDC = parseFloat(document.getElementById('mDC').value);
        const tejado = document.getElementById('tejado').value;
        const obs = document.getElementById('obs').value;

        // Estructura (2cm entre placas + 10cm margen lateral)
        const pPorFila = nP / nF;
        const mFila = (aP * pPorFila) + (0.02 * (pPorFila - 1)) + 0.20;
        const mTotal = mFila * 2 * nF;
        const fijaciones = (Math.ceil(mFila / 1.5) + 1) * 2 * nF;

        // Ley de Ohm (V=400 si P>15kW)
        const esTrif = pI > 15;
        const amp = (pI * 1000) / (esTrif ? 400 * 1.732 : 230);
        let cable = amp < 30 ? 6 : amp < 45 ? 10 : amp < 65 ? 16 : 25;

        let resHtml = `
            <div class="card" style="border-left: 5px solid #2ecc71; margin-top:20px;">
                <h3>üì¶ Listado de Materiales</h3>
                <div class="res-box"><span>Metros Perfil:</span> <span class="val">${mTotal.toFixed(2)} m</span></div>
                <div class="res-box"><span>Anclajes:</span> <span class="val">${Math.ceil(fijaciones)} uds</span></div>
                <div class="res-box"><span>Arandelas/Grower:</span> <span class="val">${Math.ceil(fijaciones*2)} uds</span></div>
                <div class="res-box"><span>Secci√≥n Cable AC:</span> <span class="val">${cable} mm¬≤ RZ1-K</span></div>
                <div class="res-box"><span>Clips Masa / Ojos:</span> <span class="val">${nP} / ${nF*2} uds</span></div>
                <div class="res-box"><span>Canalizaci√≥n (soportes):</span> <span class="val">${Math.ceil((mAC+mDC)/1.5)} uds</span></div>
            </div>
        `;

        document.getElementById('resultado').innerHTML = resHtml;
        document.getElementById('wa-btn').style.display = 'block';

        mensajeWA = `*PEDIDO ALMAC√âN: ${obra}*%0A` +
                    `--------------------------%0A` +
                    `üìè *Perfil:* ${mTotal.toFixed(2)}m%0A` +
                    `üî© *Anclajes:* ${Math.ceil(fijaciones)} uds%0A` +
                    `‚öôÔ∏è *Torniller√≠a (x2):* ${Math.ceil(fijaciones*2)} uds%0A` +
                    `üîå *Cable AC:* ${cable}mm¬≤%0A` +
                    `üè† *Fijaci√≥n:* ${tejado === 'Bovedilla' ? 'Qu√≠mico+Tamiz' : 'Autoroscante'}%0A` +
                    `üìù *Obs:* ${obs}`;
    }

    function enviarWA() {
        window.open(`https://wa.me/?text=${mensajeWA}`, '_blank');
    }
</script>
</body>
</html>
